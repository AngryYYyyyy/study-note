

# 一、MySQL简介

## 1.数据库

### （1）一些基本概念

![image-20240617131601170](.\assets\image-20240617131601170.png)

- 数据（Data）：指客观事物的描述符号，这些符号包括但不限于数字，还包括字母、文字、图形、音频、视频等多种形式。这些符号应是可识别和抽象的，现代计算机能够处理的数据范围广泛，符号表达也更为复杂。
- 数据库（Database，DB）：按照一定格式存储的数据集合，支持多用户共享并与应用程序独立存在。
- ==数据库管理系统==（Database Management System，DBMS）：==用于定义、管理、组织、存储和高效检索数据的软件==。它也==负责数据的安全性和完整性保护==。常见的数据库管理系统有Oracle、MySQL、SQL Server、DB2等。
- 数据库应用程序（Database Application System，DBAS）：基于数据库管理系统开发，使用DBMS语法，面向最终用户的直接应用程序。
- 数据库管理员（Database Administrator，DBA）：负责数据库的日常运营和维护工作。
- 最终用户（User）：数据库应用程序的直接使用者，他们通过应用程序来操作数据，而不直接与数据库交互。
- 数据库系统（Database System，DBS）：包括数据库、数据库管理系统、数据库应用程序、数据库管理员和最终用户。

### （2）类型

#### 关系型数据库（RDBMS）

关系型数据库（Relational Database Management System, RDBMS）==基于关系模型，以表格的形式存储数据==。每个表格（也称为关系）由行（记录）和列（属性）组成，表格之间通过外键等方式建立联系。

**常见系统**：

- Oracle
- MySQL
- Microsoft SQL Server
- PostgreSQL

#### 非关系型数据库（NoSQL）

非关系型数据库（NoSQL, Not Only SQL）不完全基于表格结构，可以存储非结构化和半结构化数据。它包括多种数据模型，如键值对、文档、列存储和图形数据库。

**常见系统**：

- MongoDB（文档存储）
- Redis（键值存储）
- Cassandra（列存储）
- Neo4j（图形数据库）

#### 应用场景比较

- **关系型数据库**更适合需要严格数据完整性和复杂查询的场景，如金融服务、客户关系管理（CRM）系统。
- **非关系型数据库**则适合处理大规模的数据集、快速迭代的应用开发以及对灵活性和可扩展性要求高的场景，如大数据分析、实时应用程序、内容管理系统等。

### （3）MySQL

MySQL 是一个非常流行的开源关系型数据库管理系统（RDBMS），使用结构化查询语言（SQL）进行数据操作。它由瑞典的 MySQL AB 公司开发，并于 2008 年被甲骨文公司（Oracle）收购。MySQL 是许多应用程序的首选数据库，特别是 Web 应用程序，因为它提供了高性能、稳定性和易用性的优势。

## 2.MySQL

### （1）下载与安装

> 官网[MySQL](https://www.mysql.com/cn/)

安装后默认目录如下：

软件文件夹：C:\Program Files\MySQL\MySQL Server 8.0

数据文件夹：C:\ProgramData\MySQL\MySQL Server 8.0

"C:\ProgramData\MySQL\MySQL Server 8.0\my.ini"存放MySQL配置信息，以下是需要注意的关键信息

```ini
port=3306  #监听端口是3306
datadir=C:/ProgramData/MySQL/MySQL Server 8.0\Data  #数据文件夹位置
default-storage-engine=INNODB #默认存储引擎
```

### （2）登录、访问

确保MySQL正常运行（服务端）

![image-20240617134837502](.\assets\image-20240617134837502.png)

```bash
.\mysql.exe -hlocalhost -uroot -p #在软件目录下的bin中运行
```

![image-20240617135039413](.\assets\image-20240617135039413.png)

一些简单命令

```mysql
show databases;
use database_name;
show tables
quit
```

### （3）navicat

Navicat 是一款强大的数据库管理和开发软件，支持多种数据库系统，包括 MySQL、MariaDB、SQL Server、SQLite、Oracle 和 PostgreSQL 等。它由香港的 PremiumSoft CyberTech Ltd. 开发，并为数据库管理提供了一个直观、用户友好的图形界面。Navicat 使得管理数据库、执行 SQL 脚本、同步数据库、生成报告等任务变得简单高效。

# 二、SQL语言

SQL（结构化查询语言）是用于存储、操纵和检索数据库中数据的标准编程语言，特别适用于处理关系数据库管理系统（RDBMS）。

## 1.SQL 的主要功能

### （1）**数据定义**

**DDL（数据定义语言）**创建和修改数据库的结构，如表、视图和索引。

- `CREATE`：创建新表或数据库。
- `ALTER`：修改现有数据库对象。
- `DROP`：删除数据库对象。

### （2）**数据操作**

**DML（数据操纵语言）**数据库日常管理的基本组成部分。

- `INSERT`：向表中插入新数据。
- `UPDATE`：更新表中的数据。
- `DELETE`：从表中删除数据。

### （3）数据查询

DQL（数据查询语言）用于查询数据。

- `SELECT`：从表中查询数据。

### （4）**数据控制**

**DCL（数据控制语言）**对数据库数据的访问权限。

- `GRANT`：授权用户操作或访问权限。
- `REVOKE`：撤销用户的权限。

### （5）**事务控制**

**TCL（事务控制语言）**用于数据库的事务管理。

- `COMMIT`：提交事务，使所有数据变更成为永久性的。
- `ROLLBACK`：回滚事务到某个保存点。
- `SAVEPOINT`：设置事务的保存点，用于回滚。

## 2.数据库表

表（Table）是关系型数据库中存储和组织数据的基本结构，非常适合以结构化方式表示信息。在关系型数据库中，每个表可以被看作是一个二维的数据格，具体内容包括行和列：

### （1）行（Records or Rows）

- **记录（Record）**：也称为行（Row），在表中代表一个数据实体的集合。每行包含该实体的相关信息，例如一个员工的记录可能包含员工ID、姓名、职位和联系信息等。
- **唯一性**：在理想情况下，表中的每行都应有一定方式进行唯一标识，通常是通过一个主键（Primary Key）实现。主键是一个字段（或字段的组合），其值在表中唯一。

### （2）列（Fields or Columns）

- **字段（Field）**：也称为列（Column），它定义了存储在表中的某种类型的数据。每个字段都有特定的数据类型，如整数、字符串、日期等。
- **数据类型**：定义字段可以存储的数据类型，这有助于数据库管理系统（DBMS）更有效地存储、检索和处理数据。

## 3.字段数据类型

### （1）数值数据类型
1. **整数类型**：
   - `INT`：存储标准整数。不同数据库系统可能会有不同的大小变体，如 `TINYINT`, `SMALLINT`, `MEDIUMINT`, `BIGINT` 等。
   - `DECIMAL(M, N)`：存储固定精度和比例的数值。适用于需要精确数值表示的情况，如财务数据。`M` 是数字总位数，`N` 是小数点后的位数。

2. **浮点数和双精度数**：
   - `FLOAT`：存储单精度浮点数。
   - `DOUBLE`：存储双精度浮点数。

### （2）字符串数据类型
1. **字符类型**：
   - `CHAR(N)`：固定长度的字符串。存储时，字符串长度不足 `N` 时会用空格填充。
   - `VARCHAR(N)`：可变长度的字符串。只使用实际需要的空间，并允许长度最多为 `N` 的字符串。

2. **文本类型**：
   - `TEXT`：用于存储长文本。
   - `BLOB`：二进制大对象，用于存储二进制数据，如图像、音频或其他多媒体数据。

### （3）日期和时间数据类型
1. **日期类型**：
   - `DATE`：仅存储日期（年、月、日）。
   - `TIME`：仅存储时间（小时、分钟、秒）。
   - `DATETIME`：存储日期和时间。
   - `TIMESTAMP`：存储日期和时间，通常用于记录数据变更的时间点。

2. **年份类型**：
   - `YEAR`：用于存储年份。

### （4）布尔数据类型
- **BOOLEAN**：存储真（TRUE）或假（FALSE）值。在某些数据库系统中，它可能只是 `TINYINT` 类型的别名，其中 0 表示 FALSE，非 0 值表示 TRUE。

# 三、约束

## 1.非外键约束

| 约束条件                             | 约束描述                                                     |
| ------------------------------------ | ------------------------------------------------------------ |
| 主键约束（PRIMARY KEY）              | 确保每条记录在表中的唯一性。主键字段不能有重复值，且不能为NULL。 |
| 非空约束（NOT NULL）                 | 确保字段在插入记录时必须有值，不能为NULL。                   |
| 唯一约束（UNIQUE）                   | 确保字段中的所有值都是唯一的，可以有多个NULL值，但每个NULL都被视为唯一。 |
| 检查约束（CHECK）                    | 确保字段中的值符合指定的条件。                               |
| 默认值约束（DEFAULT）                | 如果在插入记录时未指定某字段的值，则自动使用预设的默认值。   |
| 字段值自动增加约束（AUTO_INCREMENT） | 适用于整数字段，每当添加新记录时，该字段的值会自动增长。与主键通常一起使用。 |

## 2.外键约束

外键约束（Foreign Key Constraint）是关系型数据库中的一个重要概念，它用于在两个表之间建立联系并维护数据的完整性。外键约束确保一个表中的数据值必须对应另一个表的主键值，这样可以防止记录之间的悬挂引用。

- **数据完整性**：确保引用完整性，即只能输入在关联表中已存在的值。
- **参照完整性**：确保一个表中的字段值（外键值）必须在另一个表的指定字段（通常是主键）中有对应的值。
- **级联更新和删除**：如果主键表中的数据被更新或删除，相关的外键数据可以被自动更新或删除，这通过级联规则来实现。

# 四、查询

## 1.单表查询

## 2.多表查询

## 3.子查询

# 五、数据库对象

## 1.事务

事务（Transaction）是数据库管理系统中执行操作的基本单位，它可以包含一个或多个命令。事务具备四大特性，通常以ACID为代表，这些特性确保了事务的可靠执行以及数据的一致性和完整性。

### （1）ACID特性

**原子性（Atomicity）**：原子性确保事务中的操作要么全部完成，要么全部不执行。事务作为一个整体来执行，因此不会出现只执行了一部分操作的情况。

例如，如果一个银行交易涉及从一个账户扣款并向另一个账户存款，原子性将保证这两个操作要么同时成功，要么同时失败。

**一致性（Consistency）**：一致性确保事务的执行将数据库从一个一致的状态转换到另一个一致的状态。事务完成后，所有数据规则都必须应用于数据库数据，保持数据的正确性和有效性。

例如，在进行账户转账时，总金额应保持不变，即使在多个操作中分布。

**隔离性（Isolation）**：隔离性确保并发事务的执行不会互相干扰，事务对数据的修改在提交前对其他事务是不可见的。

**持久性（Durability）**：持久性确保一旦事务被提交，其结果就是永久的，即使系统发生故障也不会丢失数据。数据库系统通常通过写入事务日志来实现持久性，确保即使在系统崩溃后也可以恢复已提交的事务。

### （2）并发问题

#### 脏读（Dirty Reads）
脏读发生在一个事务读取了另一个事务尚未提交的数据。如果那个未提交的事务最终被回滚，则第一个事务读取的数据实际上是不存在的。

**例子**：

- 事务A修改一个记录的值但未提交。
- 事务B读取了事务A修改的值。
- 事务A回滚改动，导致事务B读取的数据变成了不存在的“脏”数据。

#### 不可重复读（Non-repeatable Reads）

不可重复读发生在一个事务中多次读取同一数据集合时，由于其他事务的更新操作，导致两次读取的数据不一致。

**例子**：
- 事务A读取一个记录。
- 事务B更新该记录并提交。
- 事务A再次读取同一记录，发现记录已经变化。

#### 幻读（Phantom Reads）
幻读是指当一个事务在对表中的某些记录进行多次查询时，由于另一个事务的插入操作，每次返回的记录数都可能不同。

**例子**：

- 事务A根据某个条件查询记录。
- 事务B插入符合事务A查询条件的新记录并提交。
- 事务A再次执行相同的查询，发现有新的记录出现。

每种隔离级别都是在性能和一致性之间做权衡。例如，较低的隔离级别（如读未提交）可能导致更多的并发问题，但可以获得更高的性能；而较高的隔离级别（如串行化）虽然可以避免绝大多数并发问题，但可能会降低并发性能。选择合适的隔离级别需要根据具体的应用场景和性能需求来决定。

### （3）隔离级别

| 隔离级别             | 脏读 (Dirty Reads) | 不可重复读 (Non-repeatable Reads) | 幻读 (Phantom Reads) |
| -------------------- | ------------------ | --------------------------------- | -------------------- |
| **READ UNCOMMITTED** | √ （可能发生）     | √ （可能发生）                    | √ （可能发生）       |
| **READ COMMITTED**   | × （不会发生）     | √ （可能发生）                    | √ （可能发生）       |
| **REPEATABLE READ**  | × （不会发生）     | × （不会发生）                    | √ （可能发生）       |
| **SERIALIZABLE**     | × （不会发生）     | × （不会发生）                    | × （不会发生）       |

## 2.视图

视图是基于 SQL 语句的结果集的可视化表现。它们是虚拟的表，即存在于数据库中但并不存储数据，而是在视图被访问时动态生成数据。

**主要特点**：

- **简化复杂的 SQL 操作**：视图可以封装复杂的 SQL 查询，让用户无需编写复杂的 SQL 语句即可获取数据。
- **增强数据安全性**：通过视图可以限制用户对某些数据的访问，只显示对特定用户或应用程序重要的数据列。
- **逻辑数据独立性**：视图可以作为物理数据和用户之间的抽象层，即使底层数据结构变化，视图保持不变。

## 3.存储过程

存储过程是一组为了执行特定任务而预先编写好的 SQL 语句。它存储在数据库中，可以通过简单的调用执行复杂的数据库操作。

**主要特点**：

- **性能优化**：存储过程在数据库服务器上执行，可以减少网络通信量和提高性能。
- **复用性和一致性**：存储过程可以被多个客户端程序或用户复用，保证数据操作的一致性。
- **封装逻辑**：可以在存储过程中编写复杂的逻辑，封装业务操作。
